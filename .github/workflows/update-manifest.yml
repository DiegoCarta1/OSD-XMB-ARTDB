# .github/workflows/update-manifest.yml
name: Update Game Manifest

on:
  push:
    paths-ignore:
      - 'manifest.txt'
      - 'manifest.json'
      - '.github/**'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate-manifest:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Gather game IDs
        run: |
          # List only subdirectories (one level deep) inside PS1 and PS2
          find PS1 PS2 -mindepth 1 -maxdepth 1 -type d -exec basename {} \; | sort > manifest.txt

          # Create JSON version
          jq -R -s -c '{ games: split("\n")[:-1] }' manifest.txt > manifest.json

      - name: Commit and push manifest if changed
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Update game manifest"
          file_pattern: |
            manifest.txt
            manifest.json
          branch: main
